---
applyTo: "**"
---

# Flourish - GitHub Copilot Instructions

Flourish is a React Native (Expo) app that helps users improve their wellbeing by answering questions and receiving personalized insights.

## Architecture Overview

The app uses Expo Router for file-based routing. The main navigation is a tab layout defined in `app/(tabs)/_layout.tsx`.

- **State Management**: Global state, particularly for real-time notifications, is managed via React Context. The key provider is `InsightStreamProvider` located in `contexts/InsightStream.tsx`.
- **Real-time Updates**: The app uses Server-Sent Events (SSE) to receive notifications about new insights. The connection is managed in `contexts/InsightStream.tsx`. The `useInsightStream` hook provides access to notification data and connection management functions.
- **API Communication**: All backend communication is handled through `fetch` requests. The base URL is configured in `utils/apiBase.ts`.

## Key Components & Screens

- **`app/(tabs)/questionnaire.tsx`**: Fetches questions from the backend and submits user responses.
- **`app/(tabs)/insights.tsx`**: Displays insights generated by the backend based on user responses.
- **`app/(tabs)/settings.tsx`**: Allows the user to reset their session. This calls `/v1/user/reset` to clear the uid cookie and then calls `/v1/user/id` to obtain the new user id, followed by resetting the client-side SSE connection using `resetAndReconnectStream` from the `useInsightStream` context.
- **`app/_layout.tsx`**: The root layout, which wraps the entire application in the `InsightStreamProvider` to make the insight stream context available globally.

## Technology Stack

- **Frontend**: React Native with Expo
- **Backend**: Go
- **Database**: MongoDB

## Coding Standards & Conventions

- **Authentication**: The backend uses an `HttpOnly` cookie named `uid` to manage the user session. All `fetch` requests that require authentication must include the `credentials: "include"` option.
- **API Endpoints**: All API endpoints are versioned under `/v1/`.

### Current API Endpoints

All endpoints handle a `uid` cookie for session management.

- **`GET /v1/user/id`**: returns the userID `{"uid":"<uid>"}`
- **`GET /v1/user/reset`**: removes userID cookie
- **`GET /v1/questions`**: Fetches the next set of questions for the user.
- **`POST /v1/responses`**: Submits user answers to questions.
- **`GET /v1/insights/llm`**: Fetches the available insights for the user.
- **`GET /v1/insights/llm/generate/holistic`**: Triggers the generation of a holistic insight on the backend.
- **`GET /v1/insights/stream`**: A Server-Sent Events (SSE) endpoint that streams events to the client when new insights are ready. It only sends `event:` names without a `data:` payload.


Example of an authenticated fetch call from `contexts/InsightStream.tsx`:
```typescript
const res = await fetch(streamUrl, {
  headers: { Accept: "text/event-stream" },
  credentials: "include", // Essential for sending the 'uid' cookie
  signal: controller.signal,
});
```